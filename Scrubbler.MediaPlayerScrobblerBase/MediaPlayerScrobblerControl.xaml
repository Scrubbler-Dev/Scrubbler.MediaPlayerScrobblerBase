<UserControl
    x:Class="MediaPlayerScrobblerBase.MediaPlayerScrobblerControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MediaPlayerScrobblerBase"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:beh="using:Microsoft.Xaml.Interactivity"
    xmlns:actions="using:Microsoft.Xaml.Interactions.Core"
    mc:Ignorable="d"
    d:DesignHeight="300"
    d:DesignWidth="400">

    <Grid Padding="12" RowSpacing="16" ColumnSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="1"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- STATUS BAR -->
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Spacing="12">

            <!-- Status Label -->
            <StackPanel Orientation="Horizontal" Spacing="6" VerticalAlignment="Center">
                <TextBlock Text="Status:" FontWeight="Bold"/>

                <TextBlock x:Name="StatusText">
                <beh:Interaction.Behaviors>
                    <beh:DataTriggerBehavior Binding="{Binding IsConnected}" Value="False">
                        <actions:ChangePropertyAction TargetObject="{Binding ElementName=StatusText}"
                                                      PropertyName="Text" Value="Not connected"/>
                    </beh:DataTriggerBehavior>
                    <beh:DataTriggerBehavior Binding="{Binding IsConnected}" Value="True">
                        <actions:ChangePropertyAction TargetObject="{Binding ElementName=StatusText}"
                                                      PropertyName="Text" Value="Connected"/>
                    </beh:DataTriggerBehavior>
                </beh:Interaction.Behaviors>
                </TextBlock>
            </StackPanel>

            <!-- Connect / Reconnect -->
            <Button x:Name="ConnectButton" Command="{Binding ToggleConnectionCommand}">
                <beh:Interaction.Behaviors>
                    <beh:DataTriggerBehavior Binding="{Binding IsConnected}" Value="True">
                        <actions:ChangePropertyAction
                        TargetObject="{Binding ElementName=ConnectButton}"
                        PropertyName="Content"
                        Value="Disconnect"/>
                    </beh:DataTriggerBehavior>

                    <beh:DataTriggerBehavior Binding="{Binding IsConnected}" Value="False">
                        <actions:ChangePropertyAction
                        TargetObject="{Binding ElementName=ConnectButton}"
                        PropertyName="Content"
                        Value="Connect"/>
                    </beh:DataTriggerBehavior>
                </beh:Interaction.Behaviors>
            </Button>

            <!-- Auto-Connect -->
            <CheckBox Content="Auto-Connect" IsChecked="{Binding AutoConnect}"
                  VerticalAlignment="Center"/>

            <!-- Rich Presence -->
            <CheckBox Content="Discord Rich Presence" IsChecked="{Binding UseRichPresence}"
                  VerticalAlignment="Center"/>
        </StackPanel>

        <Rectangle Grid.Row="1" Height="1" Fill="Gray" Opacity="0.3"/>

        <!-- MAIN CONTENT AREA -->
        <Grid Grid.Row="2" ColumnSpacing="16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Album Art -->
            <Border BorderBrush="Black" BorderThickness="1" Width="150" Height="150" VerticalAlignment="Top">
                <Image Stretch="UniformToFill">
                    <Image.Source>
                        <BitmapImage UriSource="{Binding CurrentAlbumArtwork, TargetNullValue=ms-appx:///Assets/noartistimage.png}" />
                    </Image.Source>
                </Image>
            </Border>

            <!-- Metadata -->
            <StackPanel Grid.Column="1" Spacing="8">

                <!-- TRACK -->
                <StackPanel>
                    <TextBlock Text="Track:" FontWeight="Bold"/>

                    <HyperlinkButton Content="{Binding CurrentTrackName}"
                                 Foreground="Blue"
                                 Command="{Binding TrackClickedCommand}"/>

                    <StackPanel x:Name="TrackPlayCount" Orientation="Horizontal" Spacing="4">
                        <beh:Interaction.Behaviors>
                            <beh:DataTriggerBehavior Binding="{Binding CurrentTrackPlayCount}" Value="-1">
                                <actions:ChangePropertyAction TargetObject="{Binding ElementName=TrackPlayCount}"
                                                              PropertyName="Visibility"
                                                              Value="Collapsed"/>
                            </beh:DataTriggerBehavior>
                            <beh:DataTriggerBehavior Binding="{Binding CanFetchPlayCounts}" Value="False">
                                <actions:ChangePropertyAction
                                        TargetObject="{Binding ElementName=TrackPlayCount}"
                                        PropertyName="Visibility"
                                        Value="Collapsed"/>
                            </beh:DataTriggerBehavior>
                        </beh:Interaction.Behaviors>

                        <TextBlock Text="{Binding CurrentTrackPlayCount}"/>
                        <TextBlock Text="Plays"/>
                    </StackPanel>
                </StackPanel>

                <!-- ARTIST -->
                <StackPanel>
                    <TextBlock Text="Artist:" FontWeight="Bold"/>
                    <HyperlinkButton Content="{Binding CurrentArtistName}"
                                 Foreground="Blue"
                                 Command="{Binding ArtistClickedCommand}"/>

                    <StackPanel x:Name="ArtistPlayCount" Orientation="Horizontal" Spacing="4">
                        <beh:Interaction.Behaviors>
                            <beh:DataTriggerBehavior Binding="{Binding CurrentArtistPlayCount}" Value="-1">
                                <actions:ChangePropertyAction
                                    TargetObject="{Binding ElementName=ArtistPlayCount}"
                                    PropertyName="Visibility"
                                    Value="Collapsed"/>
                            </beh:DataTriggerBehavior>
                            <beh:DataTriggerBehavior Binding="{Binding CanFetchPlayCounts}" Value="False">
                                <actions:ChangePropertyAction
                                        TargetObject="{Binding ElementName=ArtistPlayCount}"
                                        PropertyName="Visibility"
                                        Value="Collapsed"/>
                            </beh:DataTriggerBehavior>
                        </beh:Interaction.Behaviors>

                        <TextBlock Text="{Binding CurrentArtistPlayCount}"/>
                        <TextBlock Text="Plays"/>
                    </StackPanel>
                </StackPanel>

                <!-- ALBUM -->
                <StackPanel>
                    <TextBlock Text="Album:" FontWeight="Bold"/>
                    <HyperlinkButton Content="{Binding CurrentAlbumName}"
                                 Foreground="Blue"
                                 Command="{Binding AlbumClickedCommand}"/>

                    <StackPanel x:Name="AlbumPlayCount" Orientation="Horizontal" Spacing="4">
                        <beh:Interaction.Behaviors>
                            <beh:DataTriggerBehavior Binding="{Binding CurrentAlbumPlayCount}" Value="-1">
                                <actions:ChangePropertyAction
                                        TargetObject="{Binding ElementName=AlbumPlayCount}"
                                        PropertyName="Visibility"
                                        Value="Collapsed"/>
                            </beh:DataTriggerBehavior>
                            <beh:DataTriggerBehavior Binding="{Binding CanFetchPlayCounts}" Value="False">
                                <actions:ChangePropertyAction
                                        TargetObject="{Binding ElementName=AlbumPlayCount}"
                                        PropertyName="Visibility"
                                        Value="Collapsed"/>
                            </beh:DataTriggerBehavior>
                        </beh:Interaction.Behaviors>

                        <TextBlock Text="{Binding CurrentAlbumPlayCount}"/>
                        <TextBlock Text="Plays"/>
                    </StackPanel>
                </StackPanel>

                <!-- TAGS -->
                <StackPanel x:Name="TagPanel">
                    <beh:Interaction.Behaviors>
                        <beh:DataTriggerBehavior Binding="{Binding CanFetchTags}" Value="False">
                            <actions:ChangePropertyAction
                                        TargetObject="{Binding ElementName=TagPanel}"
                                        PropertyName="Visibility"
                                        Value="Collapsed"/>
                        </beh:DataTriggerBehavior>
                    </beh:Interaction.Behaviors>

                    <TextBlock Text="Tags:" FontWeight="Bold"/>
                    <ItemsRepeater ItemsSource="{Binding CurrentTrackTags}">
                        <ItemsRepeater.Layout>
                            <FlowLayout Orientation="Horizontal" />
                        </ItemsRepeater.Layout>

                        <ItemsRepeater.ItemTemplate>
                            <DataTemplate>
                                <HyperlinkButton Content="{Binding Name}"
                                             Foreground="Blue"
                                             Command="{Binding ClickedCommand}"/>
                            </DataTemplate>
                        </ItemsRepeater.ItemTemplate>
                    </ItemsRepeater>
                </StackPanel>

                <!-- LOVE BUTTON -->
                <Button x:Name="LoveButton" Command="{Binding ToggleLovedStateCommand}" Content="Love">
                    <beh:Interaction.Behaviors>
                        <beh:DataTriggerBehavior Binding="{Binding CurrentTrackLoved}" Value="True">
                            <actions:ChangePropertyAction
                            TargetObject="{Binding ElementName=LoveButton}"
                            PropertyName="Content"
                            Value="Unlove"/>
                        </beh:DataTriggerBehavior>
                        <beh:DataTriggerBehavior Binding="{Binding EnableControls}" Value="False">
                            <actions:ChangePropertyAction TargetObject="{Binding ElementName=LoveButton}"
                                                      PropertyName="IsEnabled" Value="False"/>
                        </beh:DataTriggerBehavior>
                        <beh:DataTriggerBehavior Binding="{Binding IsConnected}" Value="False">
                            <actions:ChangePropertyAction TargetObject="{Binding ElementName=LoveButton}"
                                                      PropertyName="IsEnabled" Value="False"/>
                        </beh:DataTriggerBehavior>
                        <beh:DataTriggerBehavior Binding="{Binding CanLoveTracks}" Value="False">
                            <actions:ChangePropertyAction TargetObject="{Binding ElementName=LoveButton}"
                                                      PropertyName="Visibility" Value="Collapsed"/>
                        </beh:DataTriggerBehavior>
                    </beh:Interaction.Behaviors>
                </Button>

                <!-- SCROBBLE METER -->
                <StackPanel>
                    <TextBlock Text="Scrobble-Meter:" FontWeight="Bold"/>
                    <ProgressBar Value="{Binding CountedSeconds}" Maximum="{Binding CurrentTrackLengthToScrobble}"/>

                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock x:Name="ScrobbleCount" Text="{Binding CountedSeconds}">
                        <beh:Interaction.Behaviors>
                            <beh:DataTriggerBehavior Binding="{Binding CurrentTrackScrobbled}" Value="True">
                                <actions:ChangePropertyAction
                                    TargetObject="{Binding ElementName=ScrobbleCount}"
                                    PropertyName="Text"
                                    Value="{Binding CurrentTrackLengthToScrobble}"/>
                            </beh:DataTriggerBehavior>
                        </beh:Interaction.Behaviors>
                        </TextBlock>
                        <TextBlock Text="/"/>
                        <TextBlock Text="{Binding CurrentTrackLengthToScrobble}"/>
                        <TextBlock Text="seconds"/>
                    </StackPanel>
                </StackPanel>
            </StackPanel>
        </Grid>

        <Grid x:Name="NotConnectedGrid" Grid.Row="2" Opacity="0.8" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
            <beh:Interaction.Behaviors>
                <beh:DataTriggerBehavior Binding="{Binding IsConnected}" Value="True">
                    <actions:ChangePropertyAction TargetObject="{Binding ElementName=NotConnectedGrid}"
                                                          PropertyName="Visibility"
                                                          Value="Collapsed"/>
                </beh:DataTriggerBehavior>
            </beh:Interaction.Behaviors>

            <Border>
                <Border.Background>
                    <AcrylicBrush AlwaysUseFallback="False"
                      TintColor="#80000000"
                      TintOpacity="0.1"/>
                </Border.Background>
            </Border>

            <TextBlock Text="Not connected" FontSize="16" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/> "
        </Grid>

    </Grid>
</UserControl>
